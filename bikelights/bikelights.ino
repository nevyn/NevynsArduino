#import "_2760339_Program.h"
#include <Button.h>

Button buttonLeft = Button(9,PULLUP);
Button buttonRight = Button(10,PULLUP);
Button buttonFront = Button(11,PULLUP);

bool shineForward = false;

enum {
 NoLight,
 BlinkLeft,
 BlinkRight,
 ShineStraight 
} state;

PROGMEM const unsigned long blink_left[][10]={
  {0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0xff00ff,0x000000,0x000000},
  {0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0xff00ff,0xff00ff},
  {0x000000,0x000000,0xff00ff,0xff00ff,0x000000,0x000000,0x000000,0x000000,0xff00ff,0xff00ff},
  {0x000000,0x000000,0x000000,0xff00ff,0xff00ff,0x000000,0x000000,0x000000,0x000000,0x000000},
  {0x000000,0x000000,0x000000,0xff00ff,0xff00ff,0x000000,0x000000,0x000000,0x000000,0x000000},
  {0x000000,0x000000,0x000000,0x000000,0xff00ff,0x000000,0x000000,0x000000,0x000000,0x000000},
  {0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000},
};

PROGMEM const unsigned long blink_right[][10]={
  {0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0xff00ff,0x000000,0x000000},
  {0x000000,0x000000,0x000000,0x000000,0x000000,0xff00ff,0xff00ff,0x000000,0x000000,0x000000},
  {0x000000,0xff00ff,0xff00ff,0x000000,0x000000,0xff00ff,0xff00ff,0x000000,0x000000,0x000000},
  {0xff00ff,0xff00ff,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000},
  {0xff00ff,0xff00ff,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000},
  {0xff00ff,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000},
  {0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000},
};

PROGMEM const unsigned long blink_straight[][10]={
  {0x000000,0x000055,0x808080,0x000055,0x000000,0x000000,0x550000,0xff0000,0x550000,0x000000},
  {0x000000,0x000033,0xcccccc,0x000033,0x000000,0x000000,0x550000,0xff0000,0x550000,0x000000},
  {0x000000,0x000044,0xffffff,0x000044,0x000000,0x000000,0x550000,0xff0000,0x550000,0x000000},
  {0x000000,0x000033,0xcccccc,0x000033,0x000000,0x000000,0x550000,0xff0000,0x550000,0x000000},
  {0x000000,0x000055,0x808080,0x000055,0x000000,0x000000,0x550000,0xff0000,0x550000,0x000000},
};

PROGMEM const unsigned long nothing[][10]={
  {0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000,0x000000},
};

void setup() {
  default_setup();
  pinMode(13, OUTPUT);
}

void loop() {
  if(buttonLeft.isPressed()){
    state = BlinkLeft;
  } else if(buttonRight.isPressed()) {
    state = BlinkRight;
  } else {
    state = shineForward ? ShineStraight : NoLight;
  }
  if(buttonFront.uniquePress()) {
    shineForward = !shineForward;
    digitalWrite(13, shineForward);
    if(state != BlinkLeft && state != BlinkRight) {
      state = shineForward ? ShineStraight : NoLight;
    }
  }
  
  if(state == BlinkLeft) {
    send_1M_pattern(blink_left, 7, 100); 
  } else if(state == BlinkRight) {
    send_1M_pattern(blink_right, 7, 100); 
  } else if(state == ShineStraight) {
    send_1M_pattern(blink_straight, 5, 70);
  } else {
    send_1M_pattern(nothing, 1, 1);
  }
  

}
